# セットアップガイド

## GitHub Pagesの設定方法

このQRコード出退勤システムをGitHub Pagesで公開する手順です。

### 1. リポジトリの設定

1. GitHubのリポジトリページにアクセス
2. 「Settings」（設定）タブをクリック
3. 左サイドバーの「Pages」をクリック

### 2. GitHub Pagesの有効化

1. 「Source」セクションで以下を選択：
   - **Source**: Deploy from a branch
   - **Branch**: `main`（またはデフォルトブランチ）
   - **Folder**: `/docs`

2. 「Save」ボタンをクリック

3. 数分後、ページ上部に以下のようなURLが表示されます：
   ```
   Your site is published at https://<ユーザー名>.github.io/<リポジトリ名>/
   ```

### 3. 初回設定

公開されたURLにアクセスして、アプリケーションの初期設定を行います。

1. トップページにアクセス
2. 右上の「⚙️ 設定」ボタンをクリック
3. 以下の情報を入力：
   - **端末ID**: この端末を識別するID（例: `office-tablet-01`）
   - **パスキー**: 8文字以上の秘密鍵（例: `SecurePass123`）
   - **リンク先URL**: 受付サーバーのURL（例: `https://your-server.com/receive`）
4. 「保存」ボタンをクリック

### 4. サーバー側の設定

受付サーバー（バックエンド）を別途セットアップする必要があります。

1. サーバーに`server/`ディレクトリの内容をデプロイ
2. `config/devices.json`を作成し、端末IDとパスキーを設定：
   ```json
   {
     "office-tablet-01": "SecurePass123"
   }
   ```
   ⚠️ フロントエンドで設定したものと同じ値を使用してください

3. Node.jsサーバーを起動：
   ```bash
   cd server
   npm install
   npm start
   ```

## 動作確認

### フロントエンド（GitHub Pages）

1. 公開されたURLにアクセス
2. 設定が完了していることを確認
3. 「出勤」または「退勤」ボタンをクリック
4. QRコードが表示されることを確認

### QRコード読み取りテスト

1. スマートフォンでQRコードを読み取る
2. 受付ページが開くことを確認
3. 初回：ユーザー名を入力して登録
4. 2回目以降：自動的に記録完了画面が表示

### ログの確認

サーバー側で`server/logs/`ディレクトリにログファイルが生成されていることを確認：

```bash
ls -la server/logs/
# valid_YYYY-MM.log - 正常なアクセスログ
# invalid_YYYY-MM.log - 異常なアクセスログ
```

## PWA（Progressive Web App）機能

### インストール方法

#### Androidスマートフォン

1. Chromeブラウザで公開URLにアクセス
2. メニュー（⋮）→「ホーム画面に追加」
3. アプリ名を確認して「追加」
4. ホーム画面にアイコンが追加されます

#### iPhone/iPad

1. Safariで公開URLにアクセス
2. 共有ボタン（□↑）→「ホーム画面に追加」
3. 「追加」をタップ
4. ホーム画面にアイコンが追加されます

### オフライン動作

PWAとしてインストールすると、以下の機能がオフラインでも利用可能です：

- QRコード表示ページの閲覧
- 設定ページの閲覧・編集
- QRコードの生成

⚠️ 注意: QRコードの読み取り（受付ページ）はサーバーへの接続が必要です。

## トラブルシューティング

### GitHub Pagesが表示されない

- 数分待ってから再度アクセスしてみてください
- ブラウザのキャッシュをクリアしてください
- リポジトリがパブリックであることを確認してください

### QRコードが生成されない

1. 設定ページで全ての項目が入力されているか確認
2. ブラウザのコンソール（F12）でエラーが出ていないか確認
3. リンク先URLが正しい形式（https://...）か確認

### トークンが無効と表示される

1. サーバー側の`config/devices.json`を確認
2. 端末IDとパスキーが正しく設定されているか確認
3. フロントエンドとサーバーのパスキーが一致しているか確認
4. QRコードの有効期限（5分）が切れていないか確認

### ログが記録されない

1. `server/logs/`ディレクトリが存在するか確認（自動生成されます）
2. サーバーのコンソールにエラーが出ていないか確認
3. ファイル書き込み権限があるか確認

## セキュリティに関する注意事項

- パスキーは定期的に変更することを推奨
- サーバーはHTTPS接続を使用することを推奨
- ログファイルには個人情報が含まれるため、適切に管理してください
- 本番環境では、サーバーへのアクセス制限を設定することを推奨

## カスタマイズ

### 有効期限の変更

QRコードの有効期限を変更する場合：

**フロントエンド** (`docs/js/token.js`)：
```javascript
isValid(timestamp, expiryMinutes = 5) // 5を任意の値に変更
```

**バックエンド** (`server/utils.js`)：
```javascript
function isTokenValid(timestamp, expiryMinutes = 5) // 5を任意の値に変更
```

### アイコンの変更

PWAアイコンを変更する場合：
1. `docs/images/icon-192.png`（192x192px）を置き換え
2. `docs/images/icon-512.png`（512x512px）を置き換え

### 色のカスタマイズ

`docs/css/style.css`で以下のカラーを変更できます：
- `.check-in-btn`: 出勤ボタンの色
- `.check-out-btn`: 退勤ボタンの色
- `body`: 背景のグラデーション
