# QR-Dakoku フロントエンドテスト

このディレクトリには、QRコード出退勤システムのフロントエンドJavaScriptコードのテストが含まれています。

## テストの概要

### テストファイル

1. **config.test.js** (9テスト)
   - 設定の保存・読み込み機能
   - 設定の検証機能
   - 設定のリセット機能

2. **token.test.js** (20テスト)
   - トークン生成機能
   - URL生成機能
   - 有効期限チェック機能
   - クエリパラメータエンコード機能

3. **app.test.js** (26テスト)
   - QRコード生成機能（check-in/check-out）
   - エラーハンドリング（「QRコードの描画に失敗しました。」エラーを含む）
   - UI要素の表示/非表示切り替え（#errorAreaなど）
   - QRCode.toCanvasライブラリの呼び出しテスト
   - タイマー機能のテスト

### テストインフラ

- **テストフレームワーク**: Jest
- **テスト環境**: jsdom（ブラウザ環境のシミュレーション）
- **モック**: localStorage、QRCode.toCanvas、sha256

## テストの実行方法

### 前提条件

Node.jsがインストールされている必要があります。

### 依存関係のインストール

```bash
cd docs
npm install
```

### テストの実行

#### すべてのテストを実行

```bash
npm test
```

#### ウォッチモードでテストを実行（ファイル変更時に自動再実行）

```bash
npm run test:watch
```

#### カバレッジ付きでテストを実行

```bash
npm run test:coverage
```

## テスト結果

全55テストが成功しています：

- ✅ config.js: 9テスト
- ✅ token.js: 20テスト
- ✅ app.js: 26テスト

## テスト対象機能

### QRコード生成
- 出勤ボタンをクリックするとQRコードが生成される
- 退勤ボタンをクリックするとQRコードが生成される
- 生成されるURLに正しいトークン情報が含まれる
- check-inとcheck-outで異なるアクションが設定される

### エラーハンドリング
- QRコード生成失敗時に「QRコードの描画に失敗しました。」エラーが表示される
- QRコード生成失敗時にQRエリアが表示されない
- トークン生成失敗時にエラーが表示される
- 設定が不完全な場合はエラーが表示される

### UI要素の表示/非表示
- QRコード表示時にボタンエリアが非表示になる
- QRコード表示時にQRエリアが表示される
- QRコードを閉じるとボタンエリアが再表示される
- エラー表示エリアが適切に表示/非表示される

### トークン生成
- 正しい構造のトークン情報を生成する
- 異なる入力に対して異なるトークンを生成する
- トークンの有効期限を正しくチェックする
- 残り時間を正しく計算する

### 設定管理
- 設定を正しく保存できる
- 保存された設定を正しく読み込める
- 設定が完了しているか確認できる
- 設定を正しくリセットできる

## 注意事項

- テストはモック環境で実行されるため、実際のブラウザ環境とは異なる場合があります
- 外部ライブラリ（QRCode.js、js-sha256）はモック化されています
- タイマー関連のテストは非同期処理を含むため、小さな遅延が追加されています
